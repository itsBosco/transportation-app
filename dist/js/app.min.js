var app=angular.module("TransportationApp",[]);app.controller("MainController",["$scope","$http",function($scope,$http){function setDefaultStops(){$scope.departureStation="BAYSHORE STATION",$scope.arrivalStation="SAN FRANCISCO STATION",getDepartInfo(70031),getArrivalInfo(70011),getDurations()}function getStops(){var tempID="";$http.get("dist/data/stops.json").then(function(results){results.data.forEach(function(stop){tempID!=stop.zone_id&&(stops.push(stop),tempID=stop.zone_id)})})}function getStopTimes(){$http.get("dist/data/stop_times.json").then(function(results){results.data.forEach(function(stopTimeInfo){stopTimes.push(stopTimeInfo)}),setDefaultStops()})}function getDepartInfo(stop_id){i=0;var departTimes=[];$scope.stopTimes.forEach(function(stopTimeInfo){stopTimeInfo.stop_id==stop_id&&"number"==typeof stopTimeInfo.trip_id&&i<10&&(getStopsForDeparture(stopTimeInfo.trip_id),departTimes.push(stopTimeInfo.departure_time),i++)}),convertTime(departTimes,"departure")}function convertTime(times,status){"arrival"==status?times.forEach(function(arrivalTime){time=arrivalTime.split(":"),d=new Date,d.setHours(+time[0]),d.setMinutes(time[1]),d.setSeconds(time[2]),$scope.arrivalTimes.push(d)}):times.forEach(function(departTime){time=departTime.split(":"),d=new Date,d.setHours(+time[0]),d.setMinutes(time[1]),d.setSeconds(time[2]),$scope.departTimes.push(d)})}function getDurations(){for(var i=0;i<$scope.departTimes.length;i++)$scope.arrivalTimes[i]-$scope.departTimes[i]<0?$scope.invalidSequence=!0:($scope.invalidSequence=!1,$scope.durationTimes.push(Math.round(($scope.arrivalTimes[i]-$scope.departTimes[i])/6e4)))}function getArrivalInfo(stop_id){i=0;var arrivalTimes=[];$scope.stopTimes.forEach(function(stopTimeInfo){stopTimeInfo.stop_id==stop_id&&"number"==typeof stopTimeInfo.trip_id&&i<$scope.departTimes.length&&(arrivalTimes.push(stopTimeInfo.arrival_time),i++)}),convertTime(arrivalTimes,"arrival")}function getStopsForDeparture(trip_id){$scope.currentTripID=trip_id,$scope.arrivalStations=[],stopTimes.forEach(function(stopTimeInfo){trip_id==stopTimeInfo.trip_id&&$scope.stops.forEach(function(stop){stop.stop_id==stopTimeInfo.stop_id&&$scope.arrivalStations.push(stop.stop_name)})})}var stops=[],stopTimes=[];$scope.arrivalTimes=[],$scope.departTimes=[],$scope.durationTimes=[],$scope.setStopID=function(position){if("arrival"==position){$scope.arrivalTimes=[],$scope.durationTimes=[];var arrivalStopID;$scope.stops.forEach(function(stop){stop.stop_name==$scope.arrivalStation&&(arrivalStopID=stop.stop_id)}),$scope.arrivalStation===$scope.departureStation?$scope.sameStationSelected=!0:$scope.sameStationSelected=!1,getArrivalInfo(arrivalStopID),getDurations()}else{$scope.departTimes=[],$scope.arrivalTimes=[],$scope.durationTimes=[];var departureStopID;$scope.stops.forEach(function(stop){stop.stop_name==$scope.departureStation&&(departureStopID=stop.stop_id)}),getDepartInfo(departureStopID)}},$scope.stops=stops,$scope.stopTimes=stopTimes,getStops(),getStopTimes()}]);